function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var r=e(require("ethjs-provider-http")),t=e(require("ethjs-query")),i=e(require("ethjs-contract")),n=e(require("ethr-did-resolver/contracts/ethr-did-registry.json")),s=require("did-jwt"),o=require("buffer"),u=require("ethr-did-resolver"),a=new(0,require("elliptic").ec)("secp256k1"),d=u.delegateTypes.Secp256k1VerificationKey2018;function c(e,r){if(o.Buffer.isBuffer(r))return"0x"+r.toString("hex");var t=e.match(/^did\/(pub|auth|svc)\/(\w+)(\/(\w+))?(\/(\w+))?$/);return t&&"base64"===t[6]?"0x"+o.Buffer.from(r,"base64").toString("hex"):r.match(/^0x[0-9a-fA-F]*$/)?r:"0x"+o.Buffer.from(r).toString("hex")}module.exports=function(){function e(e){var r=this.configureProvider(e),o=new t(r),a=e.registry||u.REGISTRY,d=new i(o)(n);if(this.registry=d.at(a),this.address=e.address,!this.address)throw new Error("No address is set for EthrDid");this.did="did:ethr:"+this.address,e.signer?this.signer=e.signer:e.privateKey&&(this.signer=s.SimpleSigner(e.privateKey))}var o=e.prototype;return o.configureProvider=function(e){return e.provider?e.provider:e.web3?e.web3.currentProvider:new r(e.rpcUrl||"https://mainnet.infura.io/ethr-did")},e.createKeyPair=function(){var e=a.genKeyPair(),r=e.getPublic("hex"),t=e.getPrivate("hex");return{address:s.toEthereumAddress(r),privateKey:t}},o.lookupOwner=function(e){void 0===e&&(e=!0);try{return e&&this.owner?Promise.resolve(this.owner):Promise.resolve(this.registry.identityOwner(this.address)).then(function(e){return e[0]})}catch(e){return Promise.reject(e)}},o.changeOwner=function(e){try{var r=this;return Promise.resolve(r.lookupOwner()).then(function(t){return Promise.resolve(r.registry.changeOwner(r.address,e,{from:t})).then(function(t){return r.owner=e,t})})}catch(e){return Promise.reject(e)}},o.addDelegate=function(e,r){var t=r.delegateType,i=void 0===t?d:t,n=r.expiresIn,s=void 0===n?86400:n;try{var o=this;return Promise.resolve(o.lookupOwner()).then(function(r){return o.registry.addDelegate(o.address,i,e,s,{from:r})})}catch(e){return Promise.reject(e)}},o.revokeDelegate=function(e,r){void 0===r&&(r=d);try{var t=this;return Promise.resolve(t.lookupOwner()).then(function(i){return t.registry.revokeDelegate(t.address,r,e,{from:i})})}catch(e){return Promise.reject(e)}},o.setAttribute=function(e,r,t,i){void 0===t&&(t=86400);try{var n=this;return Promise.resolve(n.lookupOwner()).then(function(s){return n.registry.setAttribute(n.address,u.stringToBytes32(e),c(e,r),t,{from:s,gas:i})})}catch(e){return Promise.reject(e)}},o.revokeAttribute=function(e,r,t){try{var i=this;return Promise.resolve(i.lookupOwner()).then(function(n){return i.registry.revokeAttribute(i.address,u.stringToBytes32(e),c(e,r),{from:n,gas:t})})}catch(e){return Promise.reject(e)}},o.createSigningDelegate=function(r,t){void 0===r&&(r=d),void 0===t&&(t=86400);try{var i=e.createKeyPair();return this.signer=s.SimpleSigner(i.privateKey),Promise.resolve(this.addDelegate(i.address,{delegateType:r,expiresIn:t})).then(function(e){return{kp:i,txHash:e}})}catch(e){return Promise.reject(e)}},o.signJWT=function(e,r){try{if("function"!=typeof this.signer)throw new Error("No signer configured");var t={signer:this.signer,alg:"ES256K-R",issuer:this.did};return r&&(t.expiresIn=r),Promise.resolve(s.createJWT(e,t))}catch(e){return Promise.reject(e)}},o.verifyJWT=function(e,r,t){try{return void 0===t&&(t=this.did),Promise.resolve(s.verifyJWT(e,{resolver:r,audience:t}))}catch(e){return Promise.reject(e)}},e}();
//# sourceMappingURL=index.js.map
